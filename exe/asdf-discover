#!/usr/bin/env ruby

require "asdf_discover"
require "fileutils"

FileUtils.cd(ARGV.first) if ARGV.first

if File.exist?(AsdfDiscover::TOOL_VERSIONS)
  puts "#{AsdfDiscover::TOOL_VERSIONS} already exists!"
  exit(1)
end

result = AsdfDiscover.search

unless result.consistent?
  result.conflicts.each do |conflict|
    puts "Discovered multiple versions for #{conflict.tool}:"
    conflict.sources.each do |source|
      puts "  - #{source.version} from #{source.source}"
    end
    puts
    puts ".tool-versions will include all versions discovered"
    puts "asdf, by default, will use the first entry"
    puts "You should manually reconcile which version to use"
  end
end
